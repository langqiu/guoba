Page({

  data: {

    menu: [
      {
          "name": "热销榜",
          "type": -1,
          "foods": [
              {
                  "name": "皮蛋瘦肉粥",
                  "price": 10,
                  "oldPrice": "",
                  "description": "咸粥",
                  "sellCount": 229,
                  "Count": 0,
                  "rating": 100,
                  "info": "一碗皮蛋瘦肉粥，总是我到粥店时的不二之选。香浓软滑，饱腹暖心，皮蛋的Q弹与瘦肉的滑嫩伴着粥香溢于满口，让人喝这样的一碗粥也觉得心满意足",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 0,
                          "text": "很喜欢的粥",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 1,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/c/cd/c12745ed8a5171e13b427dbc39401jpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/c/cd/c12745ed8a5171e13b427dbc39401jpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "扁豆焖面",
                  "price": 14,
                  "oldPrice": "",
                  "description": "",
                  "sellCount": 188,
                  "Count": 0,
                  "rating": 96,
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 1,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "info": "",
                  "icon": "http://fuss10.elemecdn.com/c/6b/29e3d29b0db63d36f7c500bca31d8jpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/c/6b/29e3d29b0db63d36f7c500bca31d8jpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "葱花饼",
                  "price": 10,
                  "oldPrice": "",
                  "description": "",
                  "sellCount": 124,
                  "Count": 0,
                  "rating": 85,
                  "info": "",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 1,
                          "text": "没啥味道",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 1,
                          "text": "很一般啊",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/f/28/a51e7b18751bcdf871648a23fd3b4jpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/f/28/a51e7b18751bcdf871648a23fd3b4jpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "牛肉馅饼",
                  "price": 14,
                  "oldPrice": "",
                  "description": "",
                  "sellCount": 114,
                  "Count": 0,
                  "rating": 91,
                  "info": "",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 1,
                          "text": "难吃不推荐",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/d/b9/bcab0e8ad97758e65ae5a62b2664ejpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/d/b9/bcab0e8ad97758e65ae5a62b2664ejpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "招牌猪肉白菜锅贴/10个",
                  "price": 17,
                  "oldPrice": "",
                  "description": "",
                  "sellCount": 101,
                  "Count": 0,
                  "rating": 78,
                  "info": "",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 1,
                          "text": "不脆,不好吃",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/7/72/9a580c1462ca1e4d3c07e112bc035jpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/7/72/9a580c1462ca1e4d3c07e112bc035jpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "南瓜粥",
                  "price": 9,
                  "oldPrice": "",
                  "description": "甜粥",
                  "sellCount": 91,
                  "Count": 0,
                  "rating": 100,
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/8/a6/453f65f16b1391942af11511b7a90jpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/8/a6/453f65f16b1391942af11511b7a90jpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "红豆薏米美肤粥",
                  "price": 12,
                  "oldPrice": "",
                  "description": "甜粥",
                  "sellCount": 86,
                  "Count": 0,
                  "rating": 100,
                  "info": "",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/d/22/260bd78ee6ac6051136c5447fe307jpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/d/22/260bd78ee6ac6051136c5447fe307jpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "八宝酱菜",
                  "price": 4,
                  "oldPrice": "",
                  "description": "",
                  "sellCount": 84,
                  "Count": 0,
                  "rating": 100,
                  "info": "",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/9/b5/469d8854f9a3a03797933fd01398bjpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/9/b5/469d8854f9a3a03797933fd01398bjpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "红枣山药糙米粥",
                  "price": 10,
                  "oldPrice": "",
                  "description": "",
                  "sellCount": 81,
                  "Count": 0,
                  "rating": 91,
                  "info": "",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/9/b5/469d8854f9a3a03797933fd01398bjpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/9/b5/469d8854f9a3a03797933fd01398bjpeg.jpeg?imageView2/1/w/750/h/750"
              },
              {
                  "name": "糊塌子",
                  "price": 10,
                  "oldPrice": "",
                  "description": "",
                  "sellCount": 80,
                  "Count": 0,
                  "rating": 93,
                  "info": "",
                  "ratings": [
                      {
                          "username": "3******c",
                          "rateTime": 1469281964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "2******3",
                          "rateTime": 1469271264000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      },
                      {
                          "username": "3******b",
                          "rateTime": 1469261964000,
                          "rateType": 0,
                          "text": "",
                          "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                      }
                  ],
                  "icon": "http://fuss10.elemecdn.com/0/05/097a2a59fd2a2292d08067e16380cjpeg.jpeg?imageView2/1/w/114/h/114",
                  "image": "http://fuss10.elemecdn.com/0/05/097a2a59fd2a2292d08067e16380cjpeg.jpeg?imageView2/1/w/750/h/750"
              },
          ]
      },
      {
        "name": "新品",
        "type": 2,
        "foods": [
            {
                "name": "红枣山药粥套餐",
                "price": 29,
                "oldPrice": 36,
                "description": "红枣山药糙米粥,素材包,爽口莴笋丝,四川泡菜或八宝酱菜,配菜可备注",
                "sellCount": 17,
                "Count": 0,
                "rating": 100,
                "info": "",
                "ratings": [
                    {
                        "username": "2******3",
                        "rateTime": 1469271264000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    }
                ],
                "icon": "http://fuss10.elemecdn.com/6/72/cb844f0bb60c502c6d5c05e0bddf5jpeg.jpeg?imageView2/1/w/114/h/114",
                "image": "http://fuss10.elemecdn.com/6/72/cb844f0bb60c502c6d5c05e0bddf5jpeg.jpeg?imageView2/1/w/750/h/750"
            }
        ]
      },
      {
        "name": "买一送一",
        "type": -1,
        "foods": [
            {
                "name": "皮蛋瘦肉粥",
                "price": 10,
                "oldPrice": "",
                "description": "咸粥",
                "sellCount": 229,
                "Count": 0,
                "rating": 100,
                "ratings": [
                    {
                        "username": "3******c",
                        "rateTime": 1469281964000,
                        "rateType": 0,
                        "text": "很喜欢的粥",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "2******3",
                        "rateTime": 1469271264000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "3******b",
                        "rateTime": 1469261964000,
                        "rateType": 1,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    }
                ],
                "icon": "http://fuss10.elemecdn.com/c/cd/c12745ed8a5171e13b427dbc39401jpeg.jpeg?imageView2/1/w/114/h/114",
                "image": "http://fuss10.elemecdn.com/c/cd/c12745ed8a5171e13b427dbc39401jpeg.jpeg?imageView2/1/w/750/h/750"
            },
            {
                "name": "南瓜粥",
                "price": 9,
                "oldPrice": "",
                "description": "甜粥",
                "sellCount": 91,
                "Count": 0,
                "rating": 100,
                "info": "",
                "ratings": [
                    {
                        "username": "3******c",
                        "rateTime": 1469281964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "2******3",
                        "rateTime": 1469271264000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "3******b",
                        "rateTime": 1469261964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    }
                ],
                "icon": "http://fuss10.elemecdn.com/8/a6/453f65f16b1391942af11511b7a90jpeg.jpeg?imageView2/1/w/114/h/114",
                "image": "http://fuss10.elemecdn.com/8/a6/453f65f16b1391942af11511b7a90jpeg.jpeg?imageView2/1/w/750/h/750"
            },
            {
                "name": "红豆薏米美肤粥",
                "price": 12,
                "oldPrice": "",
                "description": "甜粥",
                "sellCount": 86,
                "Count": 0,
                "rating": 100,
                "info": "",
                "ratings": [
                    {
                        "username": "3******c",
                        "rateTime": 1469281964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "2******3",
                        "rateTime": 1469271264000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "3******b",
                        "rateTime": 1469261964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    }
                ],
                "icon": "http://fuss10.elemecdn.com/d/22/260bd78ee6ac6051136c5447fe307jpeg.jpeg?imageView2/1/w/114/h/114",
                "image": "http://fuss10.elemecdn.com/d/22/260bd78ee6ac6051136c5447fe307jpeg.jpeg?imageView2/1/w/750/h/750"
            },
            {
                "name": "红枣山药糙米粥",
                "price": 10,
                "oldPrice": "",
                "description": "",
                "sellCount": 81,
                "Count": 0,
                "rating": 91,
                "info": "",
                "ratings": [
                    {
                        "username": "3******c",
                        "rateTime": 1469281964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "2******3",
                        "rateTime": 1469271264000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "3******b",
                        "rateTime": 1469261964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    }
                ],
                "icon": "http://fuss10.elemecdn.com/9/b5/469d8854f9a3a03797933fd01398bjpeg.jpeg?imageView2/1/w/114/h/114",
                "image": "http://fuss10.elemecdn.com/9/b5/469d8854f9a3a03797933fd01398bjpeg.jpeg?imageView2/1/w/750/h/750"
            },
            {
                "name": "鲜蔬菌菇粥",
                "price": 11,
                "oldPrice": "",
                "description": "咸粥",
                "sellCount": 56,
                "Count": 0,
                "rating": 100,
                "info": "",
                "ratings": [
                    {
                        "username": "3******c",
                        "rateTime": 1469281964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "2******3",
                        "rateTime": 1469271264000,
                        "rateType": 0,
                        "text": ""
                    },
                    {
                        "username": "3******b",
                        "rateTime": 1469261964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    }
                ],
                "icon": "http://fuss10.elemecdn.com/e/a3/5317c68dd618929b6ac05804e429ajpeg.jpeg?imageView2/1/w/114/h/114",
                "image": "http://fuss10.elemecdn.com/e/a3/5317c68dd618929b6ac05804e429ajpeg.jpeg?imageView2/1/w/750/h/750"
            },
            {
                "name": "田园蔬菜粥",
                "price": 10,
                "oldPrice": "",
                "description": "咸粥",
                "sellCount": 33,
                "Count": 0,
                "rating": 100,
                "info": "",
                "ratings": [
                    {
                        "username": "3******c",
                        "rateTime": 1469281964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "2******3",
                        "rateTime": 1469271264000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    },
                    {
                        "username": "3******b",
                        "rateTime": 1469261964000,
                        "rateType": 0,
                        "text": "",
                        "avatar": "http://static.galileo.xiaojukeji.com/static/tms/default_header.png"
                    }
                ],
                "icon": "http://fuss10.elemecdn.com/a/94/7371083792c19df00e546b29e344cjpeg.jpeg?imageView2/1/w/114/h/114",
                "image": "http://fuss10.elemecdn.com/a/94/7371083792c19df00e546b29e344cjpeg.jpeg?imageView2/1/w/750/h/750"
            }
        ]
      }
    ],

    shopCard: {
      "name": "张家饺王",
      "sale": 200,
      "delivery": "$100免运费/$60+$5运费",
      "avatar": "/assets/shop_page/avatar.png",
      "notice": "荠菜猪肉饺子-新品上市，卤味唐老鸭系列鸭子现价$20一只，另有买一送一水饺专区"
    },

    shopMenu: ["热销榜", "新品", "买一送一", "唐老鸭板鸭系列", "卤味蔬菜", "凉皮凉面", "包子馄饨", "斯里兰卡膏蟹超大", "唐老鸭板鸭系列", "卤味蔬菜", "凉皮凉面"],

    addIcon: "/assets/shop_page/add_icon@3x.png",
    decreaseIcon: "/assets/shop_page/less@3x.png",
    greyOrderIcon: "/assets/shop_page/order_grey@3x.png",
    redOrderIcon: "/assets/shop_page/order_red@3x.png",
    noticeIcon: "/assets/shop_page/notice.png",

    cartItem: "Item: ",
    cartTotalPrice: "Total Price:",

    toView: 0,
    totalPrice: 0,
    totalCount: 0,
    cartArray: [],

  },

  onShow: function (options) {
      console.log("fuck");
    var cartArray1 = wx.getStorageSync('cart') || [];
    if (cartArray1 != []) {
        var totalPrice = 0;
        var totalCount = 0;
        for (var i = 0; i < cartArray1.length; i++) {
            totalPrice += cartArray1[i].price * cartArray1[i].num;
            totalCount += cartArray1[i].num;
            this.data.menu[cartArray1[i].parentIndex].foods[cartArray1[i].index].Count = cartArray1[i].num;
        }
        this.setData({
            totalPrice: totalPrice,
            totalCount: totalCount,
            menu: this.data.menu,
            cartArray: cartArray1,
            //payDesc: this.payDesc()
        });
    }
  },

  selectCategory: function (e) {
    console.log(e);
    var index = e.currentTarget.dataset.itemIndex;
    this.setData({
      toView: index
    })
  },

  //添加到购物车
  addCart: function (e) {
    console.log(e);
    var index = e.currentTarget.dataset.itemIndex;
    var parentIndex = e.currentTarget.dataset.parentIndex;
    this.data.menu[parentIndex].foods[index].Count++;
    var mark = 'a' + index + 'b' + parentIndex
    var price = this.data.menu[parentIndex].foods[index].price;
    var num = this.data.menu[parentIndex].foods[index].Count;
    var name = this.data.menu[parentIndex].foods[index].name;
    var obj = { price: price, num: num, mark: mark, name: name, index: index, parentIndex: parentIndex };
    var cartArray1 = this.data.cartArray.filter(item => item.mark != mark)
    cartArray1.push(obj)
    console.log(cartArray1);
    this.setData({
        cartArray: cartArray1,
        menu: this.data.menu
    })
    try {
        wx.setStorageSync('cart', cartArray1);
        wx.setStorageSync('menu', this.data.menu);
    } catch(e) {
        console.log(e);
    }
    this.calTotalPrice();
    this.setData({
        payDesc: this.payDesc()
    })
  },

  addShopCart: function (e) {
    this.addCart(e);
  },

  //计算总价
  calTotalPrice: function () {
    var cartArray = this.data.cartArray;
    var totalPrice = 0;
    var totalCount = 0;
    for (var i = 0; i < cartArray.length; i++) {
        totalPrice += cartArray[i].price * cartArray[i].num;
        totalCount += cartArray[i].num
    }
    this.setData({
        totalPrice: totalPrice,
        totalCount: totalCount,
        //payDesc: this.payDesc()
    });
  },

  //移除商品
  decreaseCart: function (e) {
    console.log(e);
    var index = e.currentTarget.dataset.itemIndex;
    var parentIndex = e.currentTarget.dataset.parentIndex;
    this.data.menu[parentIndex].foods[index].Count--
    var num = this.data.menu[parentIndex].foods[index].Count;
    var name = this.data.menu[parentIndex].foods[index].name;
    var mark = 'a' + index + 'b' + parentIndex
    var price = this.data.menu[parentIndex].foods[index].price;
    var obj = { price: price, num: num, mark: mark, name: name, index: index, parentIndex: parentIndex };
    var cartArray1 = this.data.cartArray.filter(item => item.mark != mark);
    cartArray1.push(obj);
    console.log(cartArray1);
    this.setData({
        cartArray: cartArray1,
        menu: this.data.menu
    })
    try {
        wx.setStorageSync('cart', cartArray1);
        wx.setStorageSync('menu', this.data.menu);
    } catch(e) {
        console.log(e);
    }
    this.calTotalPrice()
    this.setData({
        payDesc: this.payDesc(),
    })
    //关闭弹起
    var count1 = 0
    for (let i = 0; i < cartArray1.length; i++) {
        if (cartArray1[i].num == 0) {
            count1++;
        }
    }
    if (count1 == cartArray1.length) {
        if (num == 0) {
            this.setData({
                cartShow: 'none'
            })
        }
    }
  },

  decreaseShopCart: function (e) {
    console.log('1');
    this.decreaseCart(e);
  },

  //差几元起送
  payDesc() {
    if (this.data.totalPrice === 0) {
        return `￥${this.data.minPrice}元起送`;
    } else if (this.data.totalPrice < this.data.minPrice) {
        let diff = this.data.minPrice - this.data.totalPrice;
        return '还差' + diff + '元起送';
    } else {
        return '去结算';
    }
  },

  //結算
  pay() {
    if (this.data.totalPrice < this.data.minPrice) {
        return;
    }
    // window.alert('支付' + this.totalPrice + '元');
    //确认支付逻辑
    var resultType = "success";
    wx.redirectTo({
        url: '../goods/pay/pay?resultType=' + resultType
    })
  },

  //彈起購物車
  toggleList: function () {
    if (!this.data.totalCount) {
        return;
    }
    this.setData({
        fold: !this.data.fold,
    })
    var fold = this.data.fold
    //console.log(this.data.fold);
    this.cartShow(fold)
  },

  cartShow: function (fold) {
    console.log(fold);
    if (fold == false) {
        this.setData({
            cartShow: 'block',
        })
    } else {
        this.setData({
            cartShow: 'none',
        })
    }
    console.log(this.data.cartShow);
  },

  tabChange: function (e) {
    var showtype = e.target.dataset.type;
    this.setData({
        status: showtype,
    });
  },
  
  tapPlaceOrder: function() {
    wx.navigateTo({
        url: '/pages/place_order/place_order'
    })
  }
})